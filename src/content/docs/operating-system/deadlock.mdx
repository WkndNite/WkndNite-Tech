---
title: 你知道什么是死锁嘛？
description: 死锁
sidebar:
    order: 6
---

> _程序卡住了，感情卡死了，一切都陷入了死锁。_

## 分析死锁问题

---

死锁发生的必要条件：

1. 互斥条件：一个资源只能被一个进程使用，如果资源被占用，其他进程需要等待，直到资源被释放。
2. 请求和保持条件：一个进程持有至少一个资源，并且请求新的资源，但是该资源被其他进程持有，此时该进程被阻塞，但是它不释放自己已经持有的资源。
3. 不可剥夺条件：进程所获得的资源在未使用完之前，不能被其他进程强行剥夺，只能由获得该资源的进程自己释放。
4. 循环等待条件：若干进程之间形成一种头尾相接的循环等待资源关系。

:::tip
在资源分配图中，如果分配图存在环，则可能存在死锁。之所以说可能，是因为如果每个资源类型有多个实例，其中有的实例被可释放资源的进程占用时，就不一定会造成死锁 。
:::

## 死锁的处理方法

---

### 预防死锁

1. 破坏互斥条件：允许多个进程同时使用资源，但是这会使得资源利用率降低，甚至可能造成系统不稳定。
2. 破坏请求和保持条件：进程在开始运行之前，一次性申请所有需要的资源，如果申请不到就等待，直到所有资源都申请到为止，容易导致饥饿。
3. 破坏不可剥夺条件：允许进程在持有部分资源的情况下，释放它所占用的资源，让其他进程使用。
4. 破坏循环等待条件：将资源进行排序，按照一定的顺序分配资源，进程只能按照顺序申请资源，避免出现循环等待的情况。

### 避免死锁

避免死锁是指确保系统不进入不安全的状态，避免死锁是一种动态的方法，它需要根据进程申请资源的附加信息决定是否申请资源。这些信息包括：当前可用资源、已分配给每个进程的资源、每个进程将来要申请或释放的资源、每个进程可能申请的每种资源类型实例的需求等。

1. 银行家算法：主要分为两部分——**安全性算法**和**资源请求算法**。
2. 资源分配图算法：在进程申请资源时，系统会判断资源分配图是否存在环，如果存在环，则不分配资源，避免死锁的发生。

:::note
资源分配图算法适用于每个资源类型具有单个实例，而银行家算法适用于每个资源类型具有多个实例。
:::

### 死锁恢复

死锁的检测需要需要维护等待图。死锁的恢复需要：

1. 终止进程：终止进程是解决死锁最简单的方法，但是可能会导致系统资源的浪费。
2. 一次只终止一个进程直到取消死循环但要考虑进程的优先级、进程完成程度、进程对资源的使用、进程是交互的还是批处理的等因素。
3. 资源抢占：从死锁进程那里抢占资源，但是这可能会导致进程的饥饿。还要涉及到回滚，不能正常运行的程序需要回滚到安全状态。

### 忽视死锁
