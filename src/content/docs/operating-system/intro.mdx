---
title: 先和操作系统打个照面
description: 操作系统的介绍
sidebar:
    order: 0
---

> _生活里总有些 bug，操作系统总有点崩溃。不同的是，系统还能 Ctrl+Alt+Del，而我只能 Ctrl 住情绪，再 Alt 些希望，最后 Del 掉烦恼。_

## 操作系统的定义

---

操作系统是一个运行在计算机用户与计算机硬件之间的**程序**，通常狭义上称为**内核程序**，其他程序则为**系统程序和应用程序**。操作系统负责管理计算机中的硬件资源和软件资源，同时为用户提供一个友好的使用环境。因此，操作系统是：

-   **资源管理平台**
-   **程序运行平台**
-   **为用户提供服务的平台**

## 计算机系统的层次结构

---

![计算机系统的层次结构](@src/assets/os/intro-cs-hierarchy.excalidraw.png)

## 计算机系统的组织

---

### 启动

1. 确认每个设备是否工作正常。确认无误后开启**引导程序**（Bootstrap Program）。
2. 引导程序一般位于**ROM**或**EEPROM**，称为计算机硬件中的**固件**。
3. 引导程序的工作内容包括：**初始化设备**、**加载操作系统**和**启动操作系统**

### 中断

1. 中断可以分为：

    - **外部中断** 和 **内部中断**，也叫 **硬中断** 和 **软中断**。
    - **外部中断**是可以屏蔽的，而**内部中断**则不能屏蔽。

    :::note[软中断]
    A trap or exception is a software-generated interrupt caused either by an error or a user request.
    :::

2. 系统一旦发生中断，就会暂停当前正在运行的程序，保存当前的程序计数器（**Program Counter**，PC），转而执行中断处理程序，处理完中断后，再返回到被中断的程序继续执行。**中断处理程序**也可以被称为**中断服务程序**（**Internet Service Routine**，ISR）。
3. 中断请求与 ISR 之间的对应关系是通过**中断向量表**（**Interrupt Vector Table**，IVT）来维护的。
4. 现代操作系统一般被视为**中断驱动**的，即通过中断来处理各种事件，也可以称为**事件驱动**。

### I/O 结构

1. **I/O 设备**可以与**CPU**同时运行，每个 I/O 设备都有一个**设备控制器**，每个设备控制器有自己的**本地缓冲器**和**设备控制器寄存器**。
2. **CPU**负责内存与本地缓冲器之间的数据传输，而设备控制器负责本地缓冲器与设备之间的数据传输。I/O 操作结束后，设备控制器会向**CPU**发送中断，通知**CPU**数据已经传输完毕。
3. 数据的读取可以通过**DMA**（**Direct Memory Access**，直接存储器访问）来加速。DMA 是一种允许外设直接与内存通信的技术，从而减少**CPU**的负担。读取单位是**数据块**。
4. I/O 操作分为：
    - **同步 I/O**：CPU 等待 I/O 操作完成后再继续执行。
    - **异步 I/O**：CPU 在 I/O 操作进行的同时继续执行其他任务。
5. **设备控制器寄存器**分为**数据寄存器**和**指令寄存器**。存储结构的层次结构是：
    - **register** → **cache** → **memory** → **solid-state disk** → **magnetic disk** → **optical disk** → **magnetic tape**

## 计算机系统的体系结构

---

计算机系统的体系结构可以分为：

1. **单处理器系统**：只有一个**CPU**和一个内存。可以进一步分为：
    - **单核处理器**：只有一个 CPU 核心。
    - **多核处理器**：拥有多个 CPU 核心。
    - **通用处理器**和**专用处理器**，有些通用处理器具备了专用处理器的功能。
2. **多处理器系统**：由多个**CPU**和一个内存组成。可以分为：

    - **对称多处理器系统**：每个 CPU 具有相同的性能和功能。
    - **非对称多处理器系统**：各 CPU 的性能和功能不同。
    - 优点：并行处理任务，增加吞吐量、可靠性和可扩展性。
    - 缺点：需要更多的硬件和软件支持。

3. **集群系统**：由多个独立的计算机系统组成，每个计算机系统有自己的**CPU**、**内存**和**I/O 设备**。可以分为：
    - **同构集群系统**：每个计算机系统具有相同的硬件和软件配置。
    - **异构集群系统**：计算机系统具有不同的硬件和软件配置。
    - 优点：提供更快的计算速度、更高的可靠性、更大的存储容量、更好的数据完整性和更广泛的可用性资源。
    - 缺点：需要更多的硬件和软件支持。

## 操作系统的结构和操作

---

操作系统的结构可以分为：

-   **批处理系统**
-   **分时系统**（又称**多任务系统**）
-   **多道程序系统**

### 双重模式操作

为了确保操作系统的正常运行，必须区分操作系统的代码和用户代码的执行。操作系统采用**双重模式操作**，即：

-   **用户模式**：用户掌握计算机的控制权，运行用户代码。
-   **内核模式**：操作系统掌握计算机的控制权，运行系统代码。

通过**模式位**（Mode bit）来区分用户模式和内核模式。

## 操作系统的管理

---

操作系统管理包括进程管理、内存管理、存储管理、I/O 管理、网络管理和安全管理等方面。

### 进程管理

进程管理是操作系统中最核心的功能之一，它负责创建、调度、执行和终止进程。进程管理包括以下几个方面：

-   **进程的创建**：操作系统负责创建新的进程，包括分配进程控制块（Process Control Block，PCB）、分配内存空间、设置进程的初始状态等。
-   **进程的调度**：操作系统负责决定哪个进程应该被运行，以及运行多长时间。调度算法包括先来先服务（FCFS）、短作业优先（SJF）、优先级调度（Priority Scheduling）等。
-   **进程的执行**：操作系统负责将进程的代码和数据加载到内存中，并开始执行进程。操作系统还负责处理进程之间的通信和同步。
-   **进程的终止**：操作系统负责终止进程，包括释放进程的内存空间、关闭进程的文件描述符、清理进程的资源等。

### 内存管理

内存管理是操作系统负责管理计算机的内存资源，包括内存的分配、回收、保护和共享等方面。内存管理包括以下几个方面：

-   **内存的分配**：操作系统负责分配内存给进程，包括分配固定大小的内存块和动态分配内存。
-   **内存的回收**：操作系统负责回收进程不再使用的内存，包括释放进程的内存块和动态回收内存。
-   **内存的保护**：操作系统负责保护内存不被非法访问，包括设置内存的访问权限和限制进程的内存访问范围。
-   **内存的共享**：操作系统负责实现进程之间的内存共享，包括共享内存和共享文件等。

### 存储管理

存储管理是操作系统负责管理计算机的存储资源，包括磁盘、闪存、SSD 等。存储管理包括以下几个方面：

-   **文件系统管理**：操作系统负责管理文件系统，包括创建文件系统、删除文件系统、格式化文件系统等。
-   **大容量存储系统管理**：一般指的是二级存储设备，其管理活动包括以下几个方面：
    -   **磁盘调度**：操作系统负责决定磁盘的读写顺序，包括先来先服务（FCFS）、最短寻道时间优先（SSTF）、扫描（SCAN）、循环（C-SCAN）等。
    -   **磁盘分区**：操作系统负责将磁盘划分为多个分区，每个分区可以包含一个或多个文件系统。
    -   **磁盘碎片整理**：操作系统负责整理磁盘碎片，提高磁盘的读写效率。
    -   **磁盘备份和恢复**：操作系统负责备份和恢复磁盘数据，包括全盘备份、增量备份、差异备份等。

### I/O 管理

I/O 子系统的目的是针对用户隐藏具体硬件设备的特性，它包括以下几个方面：

1. 一个包括缓冲、高速缓存和假脱机的内存管理部分
2. 通用设备驱动器接口
3. 特定硬件设备的驱动程序

## 其他计算机系统

---

计算机系统还包括了很多其他种类，比如分布式系统、实时系统和嵌入式系统等专用系统。
